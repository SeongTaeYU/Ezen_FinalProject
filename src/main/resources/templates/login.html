<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>로그인</title>
<style>
   body {
      background-color: white;
   }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
   function loginVal(event) {
      event.preventDefault();
      alert('버튼이 눌렸습니다.');
      
      const id = $('#userId').val();
      const pwd = $('#password').val();
      
      const user = {
         "userId": id,
         "password": pwd
      };
      
      $.ajax({
         url: "/user/login",
         type: "POST",
         data: JSON.stringify(user),
         contentType: 'application/json',
         success: function(result) {
            console.log('AJAX 성공');
            console.log(result);
            if(result) {
                window.location.href = "/user/welcome";          
            } else {
            	$('#errResult').addClass('errorMsg').text('아이디, 비밀번호를 확인해주세요.');
            }
         }
      });
   }
   
   // 세션에 로그인 값이 있는지 확인하는 함수
   function checkLogin() {
      $.ajax({
         url: "/user/checkLogin",
         type: "GET",
         success: function(result) {
            console.log('AJAX 성공');
            console.log(result);
            if(result) {
               // 로그인 상태인 경우 처리
               // 예: 다른 요소들 보이게 하기
            } else {
               // 로그인 상태가 아닌 경우 처리
               // 예: 다른 요소들 감추기, 로그인 페이지로 이동하기
               window.location.href='/user/login';
            }
         }
      });
   }
   
   // 페이지 로드 시 로그인 상태 확인
   $(document).ready(function() {
      checkLogin();
   });
</script>
</head>
<body>
   <div id="screenLeft">
      <h4>우리집 앞 소모임을 찾는다면?</h4>
      <h1>RE! crew</h1>
   </div>
   <form name="loginForm">
      <label>ID</label>
      <input type="text" id="userId" name="userId" >
      <br>
      <label>PASSWORD</label>
      <input type="password" id="password" name="password" >
      
      <br>
      <p id="errResult"></p>
      <br>
      <button id="btnLogin" type="submit" onclick="loginVal(event);">로그인</button>
   </form>
   
   <a class="registerBtn"  th:href="@{/user/register}">회원가입</a>
    
</body>
</html>